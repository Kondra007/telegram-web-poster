<html>
<head>
	<title>Telegram poster</title>
	<link rel="shortcut icon" type="image/png" href="favicon.png">
	<meta property="og:title" content="Telegram Channels Web Poster" />
	<meta property="og:description" content="A simpliest WYSIWIG Telegram channels poster" />
	<link rel="stylesheet" href="css/style.css"> <!-- Main theme -->
	<link rel="stylesheet" href="css/medium-editor.min.css"> <!-- Core -->
	<link rel="stylesheet" href="css/themes/bootstrap.min.css"> <!-- or any other theme -->
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
</head>
<body>
<div id="container">
	<h2>Telegram poster</h2>
	<div class="editable"></div>
	Bot token: <input type="text" id="token" name="token" value="" size="56"><br />
	Channel name or id: <input type="text" id="txt" name="chat_id" value=""><br />
	Hidden image (leave blank to disable) <input type="text" id="hid_img" value=""><br />
	<input type="checkbox" checked="checked" id="notif"/> Disable notifications <br />
	<input type="checkbox" id="preview"/> Disable webpage preview (removes hidden image if any) <br />
	<input value="Send post" id="btn" type="button">
</div>
<script src="js/medium-editor.min.js"></script>
<script>
var editor = new MediumEditor('.editable', {
	placeholder: {
        text: 'Type your text',
        hideOnClick: true
    },
	toolbar: {
        buttons: [
            'bold',
            'italic',
			'anchor',
        ]
    },
    activeButtonClass: 'medium-editor-button-active',
	disableReturn: false,
    spellcheck: false,
});

$("#btn").click(snd)

function snd() {

// Due to Medium-Editor problems with <p> tags, need this replacement to work properly
var txt = $("div.editable").html().replaceAll("</p><p>","\n").replaceAll("<p>","").replaceAll("</p>","");

// Hidden image is just a link to an image with zero-width text. 
// Second &#8203; is needed to avoid doubling first character if it presents in link.
// Nevermind, this just works.
if ($("#hid_img").val()) {
	txt = "<a href=\""+encodeURIComponent($("#hid_img").val())+"\">"+encodeURIComponent("&#8203;")+"</a>" + encodeURIComponent("&#8203;") + txt;
}

var params = "chat_id="+$("#txt").val()+"&text="+txt+"&parse_mode=HTML";

// Disable notifications
if ($("#notif").prop('checked') ) {
	params += "&disable_notification=true";
}

// Disable webpage preview (disables hidden image as well)
if ($("#preview").prop('checked') ) {
	params += "&disable_web_page_preview=true";
}

// http queries in JS are MAGIC for me, so I'm not responsible for this piece of code
var http = new XMLHttpRequest();
var url = "https://api.telegram.org/bot"+$("#token").val()+"/sendMessage";
http.open("POST", url, true);

http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

http.onreadystatechange = function() {
    if(http.readyState == 4 && http.status == 200) {    }
}
http.send(params);

}

// Quick'n'Dirty global replacement
String.prototype.replaceAll = function(search, replace)
{
    if (replace === undefined) {
        return this.toString();
    }

    return this.replace(new RegExp(search, 'g'), replace);
};
</script>
</body>
</html>